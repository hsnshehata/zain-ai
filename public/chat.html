<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>صفحة الدردشة</title>
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/chat.css">
  <style id="customStyles"></style>
  <script>
    async function applyDynamicStyles() {
      try {
        const response = await fetch('/api/chat-page/current', {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` },
        });
        const data = await response.json();
        const colors = data.colors || {};
        const transparentBackgroundEnabled = data.transparentBackgroundEnabled || false;
        const outerBackgroundTransparency = data.outerBackgroundTransparency || 0.5;

        const isInIframe = window.self !== window.top;

        const styleElement = document.getElementById('customStyles');
        styleElement.textContent = `
          body {
            background-color: ${isInIframe && transparentBackgroundEnabled 
              ? `rgba(${hexToRgb(colors.outerBackgroundColor || '#000000')}, ${outerBackgroundTransparency})` 
              : (colors.outerBackgroundColor || '#000000')};
          }
          .chat-container {
            background-color: ${colors.containerBackgroundColor || '#ffffff'};
            color: ${colors.text || '#ffffff'};
          }
          #chatHeader {
            background-color: ${colors.header || '#2D3436'};
          }
          #chatTitle {
            color: ${data.titleColor || '#ffffff'};
          }
          #chatMessages {
            background-color: ${colors.chatAreaBackground || '#3B4A4E'};
          }
          .user-message {
            background-color: ${colors.userMessageBackground || '#6AB04C'};
            color: ${colors.userMessageTextColor || '#ffffff'};
          }
          .bot-message {
            background-color: ${colors.botMessageBackground || '#2D3436'};
            color: ${colors.botMessageTextColor || '#ffffff'};
          }
          .suggested-question {
            background-color: ${colors.button || '#6AB04C'};
          }
          .chat-input {
            background-color: ${colors.inputAreaBackground || '#3B4A4E'};
          }
          #messageInput {
            color: ${colors.inputTextColor || '#ffffff'};
          }
          #sendMessageBtn {
            background-color: ${colors.sendButtonColor || '#6AB04C'};
          }
        `;
      } catch (err) {
        console.error('خطأ في تطبيق الألوان:', err);
      }
    }

    function hexToRgb(hex) {
      hex = hex.replace('#', '');
      const r = parseInt(hex.substring(0, 2), 16);
      const g = parseInt(hex.substring(2, 4), 16);
      const b = parseInt(hex.substring(4, 6), 16);
      return `${r}, ${g}, ${b}`;
    }

    document.addEventListener('DOMContentLoaded', applyDynamicStyles);
  </script>
</head>
<body>
  <div class="chat-container">
    <header id="chatHeader">
      <div class="header-content">
        <img id="chatLogo" src="" alt="Logo" style="display: none;">
        <h1 id="chatTitle">صفحة الدردشة</h1>
      </div>
    </header>
    <div id="suggestedQuestions" style="display: none;"></div>
    <div id="chatMessages"></div>
    <div class="chat-input">
      <input type="text" id="messageInput" placeholder="اكتب رسالتك...">
      <input type="file" id="imageInput" accept="image/*" style="display: none;">
      <button id="sendMessageBtn">إرسال</button>
    </div>
  </div>
  <script src="/js/chat.js"></script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'933aab6c3c3044f3',t:'MTc0NTIxNTMxNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9353242c3b54dd1e',t:'MTc0NTQ3MTkyMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9363b8019e0478ce',t:'MTc0NTY0NTc0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
